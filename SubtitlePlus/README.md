# SubtitlePlus

## To run the project

### Option 1: Install dependencies and run on local machine

- Install dependencies

Please make sure you have python3.7 or 3.8 or 3.9 or 3.10 installed. node.js 16 installed.

Please also install ffmpeg manually on your local machine

``` bash
git clone https://github.com/jojimmy1/SubtitlePlus
cd ./SubtitlePlus/SubtitlePlus
pip install requirements.txt
cd ./SubtitleEdit
npm install
```

- Run the backend
``` bash
npm start
cd ..
python main.py
```
Note: This will start both the python backend and the javascript backend

- Frontend
Check ```http://localhost:5000``` and the frontend will be shown

### Option 2: Run using docker (recommended for deployment)

- Get image from docker hub

``` bash
docker pull https://hub.docker.com/repository/docker/jojimmy/subplus-python
docker pull https://hub.docker.com/repository/docker/jojimmy/subplus-node
```

- Create container and run it
``` bash
docker run -p 8001:8001 jojimmy/subplus-python:v2.0.0
docker run -p 5000:5000 jojimmy/subplus-node:v2.0.0
```

- Frontend
Check ```http://localhost:5000``` and the frontend will be shown

### Option 3: Create your own docker image and then run it

- Create docker image

``` bash
git clone https://github.com/jojimmy1/SubtitlePlus
cd ./SubtitlePlus/SubtitlePlus
docker build . -t subplus-python:v2.0
cd ./SubtitleEdit
docker build . -t subplus-node:v2.0
```

- Rest of the steps will be the same as option 2

## Javascript Backend

- Please create an account on ```https://pusher.com/``` and create your own API using it.

## Python Database Schema Explanation
- Table: users
Description: Record down the user who registered an account. Record full name, id, hashed id, profile picture name.

- Table: posts
Description: Record down the postid, title, content, create time, vote count, user who created this post. Used later for displaying content of posts.

- Table: vote
Description: Record down post id and user id and an unique id generated by server. This will tell if a specific user has voted for a specific post.

## Python Backend API explanation

- API: /register
Description: Display the page for users to register, input their information.

- API: /createUser
Description: Collect info sent by the user, and record it down in the database. If the user didn’t upload a profile picture, will use the default profile picture instead. It will rename the profile picture in specific format.

- API: /<hashedcode>/create
Description: Show the page for the user to create a post. Record title and content of post.

- API: /create_done
Description: Collect information inputted by the user and store it into the database.

- API: /posts/<postid>/<hashedcode>
Description: Read the post, show the information of the post. Also allow the user to vote when reading.

- API: /<hashedcode>/profile/<pagenum>
Description: Profile page with pagination. Show the information of the profile for a specific page. It will display posts created by the certain user. It will also calculate how long has it been since the post was created and display the time.

- API: /<hashedcode>/feed/<pagenum>
Description: Feed page that will display the posts that weren’t created by the current user. It will also calculate how long has it been since the post was created and display the time.

- API: /vote
Description: When the user decided to vote for a specific page, will first check in the database if the user has voted for the post before. If not, then add a row to the vote table with userid and postid and unique id generated by server. It will return a new count. If the user has voted, it won’t make modification to the database. It will return with message that the user has voted.

- API: /delete
Description: If a user decided to delete a post. It will first check if the post exists. If it doesn't exist, it will return an error message. Otherwise, it will delete the record for the post in the vote table and in the posts table.

- API: /mldata
Description: The front end for machine learning data collection

- API: /mldata_submit
Description: Submit the data collected from html form to backend for machine learning dataset

- API: /export
Description: Merge the video and subtitle file together and generate new video that has subtitle embedded in it.

- API: /export_submit
Description: Submit the data collected from html form to backend for export

- API: /upload
Description: Automatically upload the video to specified website when conversion is done.

- API: /upload_submit
Description: Submit the data collected from html form to backend for uploading

## Video Uplaod

### upload_video.py

- API: /get_authenticated_service
Description: This function get authenticated service and store the authentication

- API: /initialize_upload
Description: This function initialize a upload to user's youtube account

- API: /resumable_upload
Description: This function implements an exponential backoff strategy to resume a failed upload.

## Merge Subtitle and Video

### merge_sub_video.py

- API: /merge_video_subtitle
Description: This function merge video and subtitle, input filenames and output filename

## Credit

- Front end and back end used code from: https://github.com/jojimmy1/Team-J-Project

- Collaborative editing supported by Pusher API, used code from: https://github.com/ankeetmaini/collaborative-text-editor

- Waveform supported by: https://github.com/katspaugh/wavesurfer.js

